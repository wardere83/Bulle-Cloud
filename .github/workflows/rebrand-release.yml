name: Rebrand BrowserOS Assets to BulleBrowser

on:
  workflow_dispatch:
    inputs:
      version:
        description: 'Version tag (e.g. v0.40.1)'
        required: true
        default: 'v0.40.1'

jobs:
  rebrand-and-upload:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: Download and rename BrowserOS assets to BulleBrowser
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          VERSION: ${{ github.event.inputs.version }}
        run: |
          set -e
          UPSTREAM="browseros-ai/BrowserOS"
          VER="${VERSION}"
          VER_NUM="${VER#v}"
          mkdir -p assets

          echo "Version: ${VER}, Version number: ${VER_NUM}"

          download_rename() {
            local ORIG="$1"
            local RENAMED="$2"
            echo "Downloading ${ORIG}..."
            gh release download "${VER}" \
              --repo "${UPSTREAM}" \
              --pattern "${ORIG}" \
              --dir assets/ \
              --clobber
            echo "Renaming to ${RENAMED}..."
            mv "assets/${ORIG}" "assets/${RENAMED}"
          }

          download_rename "BrowserOS_${VER_NUM}_x64_installer.exe" "BulleBrowser_${VER_NUM}_x64_installer.exe"
          download_rename "BrowserOS_${VER_NUM}_x64_installer.zip" "BulleBrowser_${VER_NUM}_x64_installer.zip"
          download_rename "BrowserOS_${VER_NUM}_universal.dmg" "BulleBrowser_${VER_NUM}_universal.dmg"
          download_rename "BrowserOS_${VER_NUM}_arm64.dmg" "BulleBrowser_${VER_NUM}_arm64.dmg"
          download_rename "BrowserOS_${VER_NUM}_x64.dmg" "BulleBrowser_${VER_NUM}_x64.dmg"
          download_rename "BrowserOS_${VER_NUM}_x64.AppImage" "BulleBrowser_${VER_NUM}_x64.AppImage"
          download_rename "BrowserOS_${VER_NUM}_amd64.deb" "BulleBrowser_${VER_NUM}_amd64.deb"

          echo "All assets downloaded and renamed:"
          ls -lh assets/

      - name: Upload renamed assets to BulleBrowser release
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          VERSION: ${{ github.event.inputs.version }}
        run: |
          set -e
          TARGET="wardere83/Bulle-Cloud"
          VER="${VERSION}"

          echo "Uploading renamed assets to ${TARGET} release ${VER}..."
          for FILE in assets/BulleBrowser_*; do
            echo "Uploading ${FILE}..."
            gh release upload "${VER}" \
              "${FILE}" \
              --repo "${TARGET}" \
              --clobber
          done
          echo "All BulleBrowser assets uploaded successfully!"
