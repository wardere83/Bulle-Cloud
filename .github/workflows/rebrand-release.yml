name: Rebrand BrowserOS Assets to BulleBrowser

on:
  workflow_dispatch:
    inputs:
      version:
        description: 'Version tag (e.g. v0.40.1)'
        required: true
        default: 'v0.40.1'

jobs:
  rebrand-and-upload:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: Download BrowserOS assets and rename to BulleBrowser
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          VERSION: ${{ github.event.inputs.version }}
        run: |
          set -e
          VER="${VERSION}"
          VER_NUM="${VER#v}"
          BASE_URL="https://github.com/browseros-ai/BrowserOS/releases/download/${VER}"
          mkdir -p assets

          echo "Downloading BrowserOS ${VER} assets via curl..."

          curl -L --fail -o "assets/BulleBrowser_${VER_NUM}_x64_installer.exe" \
            "${BASE_URL}/BrowserOS_${VER_NUM}_x64_installer.exe"

          curl -L --fail -o "assets/BulleBrowser_${VER_NUM}_x64_installer.zip" \
            "${BASE_URL}/BrowserOS_${VER_NUM}_x64_installer.zip"

          curl -L --fail -o "assets/BulleBrowser_${VER_NUM}_universal.dmg" \
            "${BASE_URL}/BrowserOS_${VER_NUM}_universal.dmg"

          curl -L --fail -o "assets/BulleBrowser_${VER_NUM}_arm64.dmg" \
            "${BASE_URL}/BrowserOS_${VER_NUM}_arm64.dmg"

          curl -L --fail -o "assets/BulleBrowser_${VER_NUM}_x64.dmg" \
            "${BASE_URL}/BrowserOS_${VER_NUM}_x64.dmg"

          curl -L --fail -o "assets/BulleBrowser_${VER_NUM}_x64.AppImage" \
            "${BASE_URL}/BrowserOS_${VER_NUM}_x64.AppImage"

          curl -L --fail -o "assets/BulleBrowser_${VER_NUM}_amd64.deb" \
            "${BASE_URL}/BrowserOS_${VER_NUM}_amd64.deb"

          echo "All assets downloaded:"
          ls -lh assets/

      - name: Upload renamed assets to BulleBrowser release
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          VERSION: ${{ github.event.inputs.version }}
        run: |
          set -e
          TARGET="wardere83/Bulle-Cloud"
          VER="${VERSION}"

          echo "Uploading assets to ${TARGET} release ${VER}..."
          for FILE in assets/BulleBrowser_*; do
            echo "Uploading ${FILE}..."
            gh release upload "${VER}" \
              "${FILE}" \
              --repo "${TARGET}" \
              --clobber
          done
          echo "All BulleBrowser assets uploaded successfully!"
