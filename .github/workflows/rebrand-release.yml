name: Rebrand BrowserOS Assets to BulleBrowser

on:
  workflow_dispatch:
    inputs:
      version:
        description: 'Version tag (e.g. v0.40.1)'
        required: true
        default: 'v0.40.1'

jobs:
  rebrand-and-upload:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: Download BrowserOS assets and rename to BulleBrowser
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          VERSION: ${{ github.event.inputs.version }}
        run: |
          set -e
          VER="${VERSION}"
          VER_NUM="${VER#v}"
          BASE_URL="https://github.com/browseros-ai/BrowserOS/releases/download/${VER}"
          mkdir -p assets

          echo "Downloading BrowserOS ${VER} (${VER_NUM}) assets..."

          dl() {
            local SRC="$1" DEST="$2"
            echo "  ${SRC} -> ${DEST}"
            curl -L --fail \
              -H "Authorization: token ${GH_TOKEN}" \
              -o "assets/${DEST}" \
              "${BASE_URL}/${SRC}"
          }

          dl "BrowserOS_${VER_NUM}_x64_installer.exe"   "BulleBrowser_${VER_NUM}_x64_installer.exe"
          dl "BrowserOS_${VER_NUM}_x64_installer.zip"   "BulleBrowser_${VER_NUM}_x64_installer.zip"
          dl "BrowserOS_${VER_NUM}_universal.dmg"       "BulleBrowser_${VER_NUM}_universal.dmg"
          dl "BrowserOS_${VER_NUM}_arm64.dmg"           "BulleBrowser_${VER_NUM}_arm64.dmg"
          dl "BrowserOS_${VER_NUM}_x64.dmg"             "BulleBrowser_${VER_NUM}_x64.dmg"
          dl "BrowserOS_${VER_NUM}_x64.AppImage"        "BulleBrowser_${VER_NUM}_x64.AppImage"
          dl "BrowserOS_${VER_NUM}_amd64.deb"           "BulleBrowser_${VER_NUM}_amd64.deb"

          echo "Downloaded and renamed:"
          ls -lh assets/

      - name: Upload renamed assets to BulleBrowser release
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          VERSION: ${{ github.event.inputs.version }}
        run: |
          set -e
          VER="${VERSION}"
          echo "Uploading to wardere83/Bulle-Cloud release ${VER}..."
          for FILE in assets/BulleBrowser_*; do
            echo "  Uploading $(basename ${FILE})..."
            gh release upload "${VER}" "${FILE}" \
              --repo "wardere83/Bulle-Cloud" \
              --clobber
          done
          echo "All done!"
