name: Rebrand BrowserOS Assets to BulleBrowser

on:
  workflow_dispatch:
    inputs:
      version:
        description: 'Version tag (e.g. v0.40.1)'
        required: true
        default: 'v0.40.1'

jobs:
  rebrand-and-upload:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: Install GitHub CLI
        run: sudo apt-get install -y gh

      - name: Download BrowserOS assets and rename to BulleBrowser
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          VERSION: ${{ github.event.inputs.version }}
        run: |
          set -e
          VER="${VERSION}"
          VER_NUM="${VER#v}"
          mkdir -p assets
          echo "Version: ${VER}, Num: ${VER_NUM}"

          dl() {
            local SRC="$1" DEST="$2"
            local URL="https://github.com/browseros-ai/BrowserOS/releases/download/${VER}/${SRC}"
            echo "  Downloading ${SRC}..."
            wget -q --show-progress --no-check-certificate \
              -O "assets/${DEST}" \
              "${URL}"
            echo "  Saved as ${DEST}"
          }

          dl "BrowserOS_${VER_NUM}_x64_installer.exe"   "BulleBrowser_${VER_NUM}_x64_installer.exe"
          dl "BrowserOS_${VER_NUM}_x64_installer.zip"   "BulleBrowser_${VER_NUM}_x64_installer.zip"
          dl "BrowserOS_${VER_NUM}_universal.dmg"       "BulleBrowser_${VER_NUM}_universal.dmg"
          dl "BrowserOS_${VER_NUM}_arm64.dmg"           "BulleBrowser_${VER_NUM}_arm64.dmg"
          dl "BrowserOS_${VER_NUM}_x64.dmg"             "BulleBrowser_${VER_NUM}_x64.dmg"
          dl "BrowserOS_${VER_NUM}_x64.AppImage"        "BulleBrowser_${VER_NUM}_x64.AppImage"
          dl "BrowserOS_${VER_NUM}_amd64.deb"           "BulleBrowser_${VER_NUM}_amd64.deb"

          echo "All assets ready:"
          ls -lh assets/

      - name: Upload renamed assets to BulleBrowser release
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          VERSION: ${{ github.event.inputs.version }}
        run: |
          set -e
          VER="${VERSION}"
          echo "Uploading to wardere83/Bulle-Cloud release ${VER}..."
          for FILE in assets/BulleBrowser_*; do
            echo "  Uploading $(basename ${FILE})..."
            gh release upload "${VER}" "${FILE}" \
              --repo "wardere83/Bulle-Cloud" \
              --clobber
          done
          echo "All done!"
