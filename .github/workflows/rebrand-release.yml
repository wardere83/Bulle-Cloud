name: Rebrand BrowserOS Assets to BulleBrowser

on:
  workflow_dispatch:
    inputs:
      version:
        description: 'Version tag (e.g. v0.40.1)'
        required: true
        default: 'v0.40.1'

jobs:
  rebrand-and-upload:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - name: Download BrowserOS assets and rename to BulleBrowser
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          VERSION: ${{ github.event.inputs.version }}
        run: |
          set -e
          VER="${VERSION}"
          mkdir -p assets
          echo "Downloading BrowserOS ${VER} assets..."

          FILES=(
            "BrowserOS_${VER}_amd64.deb"
            "BrowserOS_${VER}_arm64.dmg"
            "BrowserOS_${VER}_universal.dmg"
            "BrowserOS_${VER}_x64.AppImage"
            "BrowserOS_${VER}_x64.dmg"
            "BrowserOS_${VER}_x64_installer.exe"
            "BrowserOS_${VER}_x64_installer.zip"
          )

          for SRC in "${FILES[@]}"; do
            DEST=$(echo "${SRC}" | sed 's/BrowserOS/BulleBrowser/')
            URL="https://github.com/browseros-ai/BrowserOS/releases/download/${VER}/${SRC}"
            echo "  Downloading ${SRC} -> ${DEST}"
            wget -q --show-progress -O "assets/${DEST}" "${URL}" || echo "  WARNING: Failed to download ${SRC}"
          done

          echo "Assets ready:"
          ls -lh assets/

      - name: Upload renamed assets to BulleBrowser release
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          VERSION: ${{ github.event.inputs.version }}
        run: |
          set -e
          VER="${VERSION}"
          echo "Uploading to wardere83/Bulle-Cloud release ${VER}..."
          for FILE in assets/BulleBrowser_*; do
            if [ -f "${FILE}" ]; then
              echo "  Uploading $(basename ${FILE})..."
              gh release upload "${VER}" "${FILE}" \
                --repo "wardere83/Bulle-Cloud" \
                --clobber
            fi
          done
          echo "All done!"
